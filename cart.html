<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
<title>Flarivana candle ‚Äî –ê–¥–º–∏–Ω–∫–∞</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header>
    <h1>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
    <a href="index.html">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
  </header>
  <main>
    <div id="cart-items"></div>
    <div id="total"></div>

    <form id="order-form">
      <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
      <input type="text" id="order-name" placeholder="–í–∞—à–µ –∏–º—è" required><br>
      <input type="tel" id="order-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required><br>
      <input type="text" id="order-city" placeholder="–ì–æ—Ä–æ–¥" required><br>
      <input type="text" id="order-address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required><br>
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </form>
  </main>

  <script>
    const cartItemsEl = document.getElementById('cart-items');
    const totalEl = document.getElementById('total');
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        const selected = data.filter(product => cart.includes(product.id));
        let total = 0;
        selected.forEach(product => {
          total += product.price;
          const item = document.createElement('div');
          item.innerHTML = `
            <h4>${product.name}</h4>
            <p>${product.price} ‚Ç∏</p>
            <hr>
          `;
          cartItemsEl.appendChild(item);
        });
        totalEl.innerHTML = `<h3>–ò—Ç–æ–≥–æ: ${total} ‚Ç∏</h3>`;
      });

    document.getElementById('order-form').addEventListener('submit', function (e) {
      e.preventDefault();

      const name = document.getElementById("order-name").value.trim();
      const phone = document.getElementById("order-phone").value.trim();
      const city = document.getElementById("order-city").value.trim();
      const address = document.getElementById("order-address").value.trim();
      const cart = JSON.parse(localStorage.getItem("cart") || "[]");

      if (!name || !phone || !city || !address) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.");
        return;
      }

      fetch('data.json')
        .then(res => res.json())
        .then(data => {
          const selected = data.filter(p => cart.includes(p.id));
          if (selected.length === 0) {
            alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
            return;
          }

          let message = `üïØÔ∏è –ù–æ–≤—ã–π –∑–∞–∫–∞–∑:\n`;
          message += `üë§ –ò–º—è: ${name}\n`;
          message += `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n`;
          message += `üèôÔ∏è –ì–æ—Ä–æ–¥: ${city}\n`;
          message += `üè° –ê–¥—Ä–µ—Å: ${address}\n\n`;
          message += `üõçÔ∏è –¢–æ–≤–∞—Ä—ã:\n`;

          let total = 0;
          selected.forEach(p => {
            message += `‚Ä¢ ${p.name} ‚Äì ${p.price} ‚Ç∏\n`;
            total += p.price;
          });

          message += `\nüí∞ –ò—Ç–æ–≥–æ: ${total} ‚Ç∏`;

          const whatsappUrl = `https://wa.me/77479573817?text=${encodeURIComponent(message)}`;
          window.open(whatsappUrl, '_blank');

          localStorage.removeItem('cart');
          location.href = 'index.html';
        });
    });
  </script>
</body>

</html>